<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agendinha de Estudos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f0f2f5;
  }
  h1 {
    color: #5C6AC4;
    margin-bottom: 15px;
  }
  #container {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }
  #topics, #agenda, #monthsContainer, #radarContainer {
    background: #fff;
    border-radius: 5px;
    padding: 15px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  #topics {
    width: 280px;
    max-height: 80vh;
    overflow-y: auto;
  }
  #topics h2 {
    margin-top: 0;
  }
  .topic-item {
    margin: 5px 0;
    padding: 6px 8px;
    border-radius: 4px;
    user-select: none;
    cursor: grab;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .topic-item:active {
    cursor: grabbing;
  }
  /* Colors by category */
  .matematica {
    background: #4169e1;
  }
  .biologia {
    background: #2e8b57;
  }
  .quimica {
    background: #800080;
  }
  .fisica {
    background: #b22222;
  }
  .geografia {
    background: #fff1c1;
    color: #5a4d12;
  }
  .historia {
    background: #ffd18c;
    color: #5a4d12;
  }
  .portugues {
    background: #f9d5e5;
    color: #6a1b4d;
  }
  .filosofia-sociologia-literatura {
    background: #cde7f0;
    color: #1a4e7a;
  }
  #agenda {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    max-height: 80vh;
    overflow-y: auto;
  }
  .day, .month {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    min-height: 150px;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }
  .day h3, .month h4 {
    margin: 0 0 8px 0;
    font-size: 1em;
    border-bottom: 1px solid #ccc;
    padding-bottom: 3px;
    text-align: center;
  }
  .day-content, .month-content {
    flex: 1;
    overflow-y: auto;
  }
  .day-content .topic-item, .month-content .topic-item {
    margin: 4px 0;
    border-radius: 4px;
    padding: 4px 6px;
    cursor: default;
  }
  .remove-btn {
    color: #faa;
    font-weight: bold;
    cursor: pointer;
    margin-left: 10px;
  }
  #monthsContainer {
    display: none;
    margin-top: 20px;
    flex: 1;
  }
  #monthsGrid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  /* Buttons */
  button {
    margin-right: 8px;
    padding: 7px 14px;
    border: none;
    background-color: #5C6AC4;
    color: white;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background-color: #4a54a1;
  }
  /* Checkbox and span layout in month topics */
  .month-content .topic-item {
    cursor: default;
    display: flex !important;
    align-items: center;
    transition: background-color 0.25s ease, opacity 0.25s ease;
  }
  .month-content .topic-item input.month-check {
    margin-right: 8px;
    cursor: pointer;
    width: 18px;
    height: 18px;
    transition: transform 0.2s ease;
  }
  .month-content .topic-item input.month-check:checked {
    animation: checkScale 0.3s ease forwards;
  }
  @keyframes checkScale {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
  .month-content .topic-item.checked {
    opacity: 0.6;
    background-color: #222;
    color: #bbb;
  }
  .month-content .topic-item.checked span {
    text-decoration: line-through;
  }
  /* Radar dos conteúdos - níveis (cores texto) */
  .radar-0 {
    color: #721c24 !important;
  }
  .radar-1 {
    color: #856404 !important;
  }
  .radar-2 {
    color: #0c5460 !important;
  }
  .radar-3 {
    color: #155724 !important;
  }
  /* Radar container styling */
  #radarContainer {
    display: none;
    margin: 0;
    padding: 15px;
    background: #fff;
    border-radius: 5px;
    flex: 1;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  #radarLevels {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    height: 100%;
  }
  .radar-level {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    min-height: 400px;
    max-height: 650px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    color: inherit;
  }
  .radar-level strong {
    font-size: 1em;
    margin-bottom: 8px;
    user-select: none;
    color: #333;
  }
  .radar-level .topic-item {
    user-select: none;
    cursor: grab;
    margin-bottom: 4px;
    padding: 4px 6px;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .radar-level .topic-item.matematica {
    background: #4169e1;
    color: #fff !important;
  }
  .radar-level .topic-item.biologia {
    background: #2e8b57;
    color: #fff !important;
  }
  .radar-level .topic-item.quimica {
    background: #800080;
    color: #fff !important;
  }
  .radar-level .topic-item.fisica {
    background: #b22222;
    color: #fff !important;
  }
  .radar-level .topic-item.geografia {
    background: #fff1c1;
    color: #5a4d12 !important;
  }
  .radar-level .topic-item.historia {
    background: #ffd18c;
    color: #5a4d12 !important;
  }
  .radar-level .topic-item.portugues {
    background: #f9d5e5;
    color: #6a1b4d !important;
  }
  .radar-level .topic-item.filosofia-sociologia-literatura {
    background: #cde7f0;
    color: #1a4e7a !important;
  }
  .radar-level .topic-item .remove-btn {
    color: #d44;
    font-weight: bold;
    cursor: pointer;
    margin-left: 10px;
  }
</style>
</head>
<body>
<h1>Agendinha de Estudos - Arraste os conteúdos</h1>

<button id="saveBtn">Salvar Agenda</button>
<button id="loadBtn">Carregar Agenda</button>
<button id="monthBtn">Organizar por Mês</button>
<button id="radarBtn">Radar dos conteúdos</button>

<div id="container">
  <div id="topics">
    <h2>Conteúdos</h2>
  </div>

  <!-- Dias da semana -->
  <div id="agenda"></div>

  <!-- Meses -->
  <div id="monthsContainer">
    <h3>Organize seus conteúdos por mês</h3>
    <div id="monthsGrid">
      <div class="month" data-month="Janeiro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Janeiro</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Fevereiro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Fevereiro</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Março" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Março</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Abril" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Abril</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Maio" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Maio</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Junho" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Junho</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Julho" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Julho</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Agosto" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Agosto</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Setembro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Setembro</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Outubro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Outubro</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Novembro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Novembro</h4>
        <div class="month-content"></div>
      </div>
      <div class="month" data-month="Dezembro" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h4>Dezembro</h4>
        <div class="month-content"></div>
      </div>
    </div>
  </div>

  <!-- Radar substitui agenda -->
  <div id="radarContainer">
    <div id="radarLevels">
      <div class="radar-level" data-level="0" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Nunca estudei</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="1" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Já estudei mas não entendi muito a teoria/tenho muitas lacunas e não sei fazer os exercícios</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="2" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Já estudei toda a teoria mas erro muitos exercícios</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="3" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Domino</strong>
        <div class="radar-content"></div>
      </div>
    </div>
    <button id="radarClearBtn" style="margin-top: 15px;">Limpar Radar</button>
  </div>
</div>

<script>
const days = [
  "Segunda-feira",
  "Terça-feira",
  "Quarta-feira",
  "Quinta-feira",
  "Sexta-feira",
  "Sábado",
  "Domingo"
];

const mathTopics = [
  "Números e suas operações básicas",
  "Habilidades mentais básicas",
  "Frações e suas propriedades",
  "MMC, MDC e Fatoração",
  "Potenciação e radiciação",
  "Razão e Proporção",
  "Porcentagem",
  "Unidades de Medida",
  "Gráficos e Tabelas",
  "Escalas",
  "Conjuntos",
  "Estatística",
  "Função do primeiro grau",
  "Função do segundo grau",
  "Progressão aritmética",
  "Progressão geométrica",
  "Análise combinatória",
  "Probabilidade",
  "Geometria plana",
  "Geometria espacial",
  "Trigonometria",
  "Logaritmos",
  "Matemática financeira",
  "Equações",
  "Sistemas de equações"
].map(t => ({text: t, category: "matematica"}));

const bioTopics = [
  "Bioquímica", "Citologia", "Bioenergética", "Biologia Molecular",
  "Biotecnologia e Engenharia Genética", "Citogenética", "Ciclo Celular",
  "Origem da Vida", "Evolução", "Genética", "Ecologia", "Problemas Ambientais",
  "Ciclo Menstrual", "Sistema nervoso", "Sistema digestório",
  "Sistema cardiorrespiratório", "Sistema Imunológico", "Botânica",
  "Zoologia", "Microbiologia", "Histologia", "Sangue", "Doenças", "Drogas",
  "Taxonomia e Classificação dos Seres Vivos", "Reprodução Humana", "Embriologia"
].map(t => ({text: t, category: "biologia"}));

const chemistryTopics = [
  "Estudo da matéria", "Átomos", "Tabela Periódica", "Ligações Químicas",
  "Funções Inorgânicas", "Radioatividade", "Estequiometria", "Soluções",
  "Química Orgânica", "Reações Orgânicas", "Polímeros", "Isomeria",
  "Termoquímica", "Eletroquímica", "Cinética Química",
  "Equilíbrio Químico", "Propriedades Coligativas"
].map(t => ({text: t, category: "quimica"}));

const physicsTopics = [
  "Cinemática",
  "Dinâmica",
  "Ondulatória",
  "Termologia",
  "Estática",
  "Quantidade de Movimento e Impulso",
  "Trabalho e Energia",
  "Potência e Eficiência",
  "Gravitação",
  "Vetores",
  "Eletrostática",
  "Eletrodinâmica",
  "Hidrostática",
  "Óptica",
  "Eletromagnetismo"
].map(t => ({text: t, category: "fisica"}));

const geographyTopics = [
  "Geografia Física",
  "Meio Ambiente e Energia",
  "Geopolítica",
  "Geografia Econômica",
  "População",
  "Industrialização e Urbanização",
  "Geografia Agrária"
].map(t => ({text: t, category: "geografia"}));

const historyTopics = [
  "Brasil Colônia",
  "Brasil Império",
  "Brasil República",
  "Civilização pré-colombiana",
  "Pré-história",
  "Antiguidade",
  "Idade média",
  "Idade moderna",
  "Idade contemporânea"
].map(t => ({ text: t, category: "historia" }));

const portuguesTopics = [
  "Funções da linguagem",
  "Figuras da linguagem",
  "Variações linguísticas",
  "Campanhas publicitárias",
  "Gêneros e tipos textuais",
  "Interpretação de Texto",
  "Poemas"
].map(t => ({text: t, category: "portugues"}));

const filosofiaSociologiaLiteraturaTopics = [
  "Filosofia",
  "Sociologia",
  "Literatura"
].map(t => ({text: t, category: "filosofia-sociologia-literatura"}));

const allTopics = [
  ...mathTopics,
  ...bioTopics,
  ...chemistryTopics,
  ...physicsTopics,
  ...geographyTopics,
  ...historyTopics,
  ...portuguesTopics,
  ...filosofiaSociologiaLiteraturaTopics 
];

// Renderiza lista de conteúdos no container de conteúdos (todos menos os do radar)
const topicsDiv = document.getElementById("topics");

// Função para renderizar os conteúdos restantes (fora do radar) no painel de conteúdos
function renderTopicsPanel() {
  // Recupera todos os tópicos que estão no radar
  const radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  const radarTopics = new Set(Object.keys(radarData));

  // Limpa a div antes de renderizar
  // Porém mantém o título h2 no topo
  topicsDiv.querySelectorAll('.topic-item').forEach(item => item.remove());

  allTopics.forEach(({text, category}) => {
    if (!radarTopics.has(text)) { // só adiciona se não estiver no radar
      const div = document.createElement("div");
      div.classList.add("topic-item", category);
      div.textContent = text;
      div.draggable = true;
      div.addEventListener("dragstart", dragStart);
      topicsDiv.appendChild(div);
    }
  });
}

// Renderiza agenda dos dias da semana
const agendaDiv = document.getElementById("agenda");
days.forEach(day => {
  const dayDiv = document.createElement("div");
  dayDiv.className = "day";
  dayDiv.dataset.day = day;
  dayDiv.innerHTML = `<h3>${day}</h3><div class="day-content" ondrop="drop(event)" ondragover="allowDrop(event)"></div>`;
  agendaDiv.appendChild(dayDiv);
});

function dragStart(event) {
  const el = event.target;
  event.dataTransfer.setData("text/plain", el.textContent);
  event.dataTransfer.effectAllowed = "copyMove";

  // Save source container id/type to differentiate the move
  event.dataTransfer.setData("source-type", getContainerType(el.parentElement));

  // Save serialized element HTML for recreating if need be
  event.dataTransfer.setData("source-html", el.outerHTML);
}

// Helper: identify container type where drag started (topics, radar-content, day-content, month-content)
function getContainerType(container) {
  if (!container) return '';

  if (container.id === "topics") return "topics";
  if (container.classList.contains("radar-content")) return "radar";
  if (container.classList.contains("day-content")) return "day";
  if (container.classList.contains("month-content")) return "month";
  return '';
}

function allowDrop(event) {
  event.preventDefault();
  event.dataTransfer.dropEffect = "copy";
}

function drop(event) {
  event.preventDefault();
  const topic = event.dataTransfer.getData("text/plain");
  if (!topic) return;

  let container = event.currentTarget;
  // If drop target is not directly content container, find its content container inside
  if (!container.classList.contains("day-content")
      && !container.classList.contains("month-content")
      && !container.classList.contains("radar-content")
      && container.id !== 'topics') {
    container = container.querySelector(".day-content") || container.querySelector(".month-content") || container.querySelector(".radar-content") || container;
  }

  // Avoid duplicates in target container
  const existing = Array.from(container.children).some(child => {
    const textOnly = child.textContent.replace("×", "").trim();
    return textOnly === topic;
  });
  if (existing) return;

  // Find category of the dragged topic
  let category = "";
  for (const ctp of allTopics) {
    if (ctp.text === topic) {
      category = ctp.category;
      break;
    }
  }
  if (!category) category = "matematica";

  // Identify source container type
  const sourceType = event.dataTransfer.getData("source-type");
  // Get html of dragged element to preserve structure when moving from radar
  const sourceHTML = event.dataTransfer.getData("source-html");

  if(container.id === "topics") {
    // Only allow drop if source is NOT topics (can't drop to topics... topics is source from radar removal)
    // So no do nothing here.
    return;
  }

  if(container.classList.contains("month-content")) {
    // Month container: create with checkbox and span
    const newTopic = document.createElement("div");
    newTopic.className = `topic-item ${category}`;

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.className = "month-check";
    checkbox.title = "Marcar como concluído";

    const spanText = document.createElement("span");
    spanText.textContent = topic;

    newTopic.appendChild(checkbox);
    newTopic.appendChild(spanText);

    checkbox.addEventListener('change', () => {
      if(checkbox.checked) {
        newTopic.classList.add('checked');
      } else {
        newTopic.classList.remove('checked');
      }
    });

    const removeBtn = document.createElement("span");
    removeBtn.textContent = "×";
    removeBtn.title = "Remover";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => {
      newTopic.remove();
    };
    newTopic.appendChild(removeBtn);

    container.appendChild(newTopic);
  } else if(container.classList.contains("radar-content")) {
    // Radar container: moving an element to radar level means update radarData,
    // then rerender radarContent and topics panel.
    // The dropped element should come from topics panel or other radar-level.

    // Get level from radar-level container
    const radarLevelDiv = container.closest(".radar-level");
    if(!radarLevelDiv) return;
    const level = radarLevelDiv.dataset.level;

    // Update radar data
    let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
    radarData[topic] = parseInt(level);

    // Save radar data
    localStorage.setItem('radarData', JSON.stringify(radarData));

    // Refresh radar and topics panel
    renderRadarContent();
    renderTopicsPanel();
    updateRadarMarks();

  } else if(container.classList.contains("day-content")) {
    // Day container: simple div with text and remove button
    const newTopic = document.createElement("div");
    newTopic.className = `topic-item ${category}`;
    newTopic.textContent = topic;

    const removeBtn = document.createElement("span");
    removeBtn.textContent = "×";
    removeBtn.title = "Remover";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => { newTopic.remove(); };
    newTopic.appendChild(removeBtn);

    container.appendChild(newTopic);
  }

  // Remove the dragged element from original container if "move" effect
  if (sourceType === "radar") {
    // From radar: remove from radarData, then rerender topics and radar
    let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
    if (radarData.hasOwnProperty(topic)) {
      delete radarData[topic];
      localStorage.setItem('radarData', JSON.stringify(radarData));
      renderRadarContent();
      renderTopicsPanel();
      updateRadarMarks();
    }
  }
  else if (sourceType === "topics") {
    // From topics container, remove the original element after drop 
    // since topics panel is recreated by renderTopicsPanel(), just remove dragged element here.
    // But handle possibility of fast dragging, no precise element to remove from DOM.
    // Just rerender topics panel to be safe.
    renderTopicsPanel();
  }
  else {
    // Other source - e.g. day, month - no remove from source (copy)
  }
}

const monthBtn = document.getElementById('monthBtn');
const monthsContainer = document.getElementById('monthsContainer');
const agenda = document.getElementById('agenda');
const radarContainer = document.getElementById('radarContainer');

monthBtn.addEventListener('click', () => {
  if (monthsContainer.style.display === 'none' || monthsContainer.style.display === '') {
    monthsContainer.style.display = 'block';
    agenda.style.display = 'none';
    radarContainer.style.display = 'none';
  } else {
    monthsContainer.style.display = 'none';
    agenda.style.display = 'grid';
    radarContainer.style.display = 'none';
  }
});

const radarBtn = document.getElementById('radarBtn');
radarBtn.addEventListener('click', () => {
  if (radarContainer.style.display === 'none' || radarContainer.style.display === '') {
    radarContainer.style.display = 'flex';
    agenda.style.display = 'none';
    monthsContainer.style.display = 'none';
  } else {
    radarContainer.style.display = 'none';
    agenda.style.display = 'grid';
  }
});

function saveAgenda() {
  const agendaData = {};
  days.forEach(day => {
    const dayContent = document.querySelector(`.day[data-day="${day}"] .day-content`);
    agendaData[day] = Array.from(dayContent.children)
      .map(c => c.textContent.replace("×", "").trim());
  });

  const months = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  months.forEach(month => {
    const monthContent = Array.from(document.querySelectorAll('.month')).find(m => m.dataset.month === month);
    if (monthContent) {
      const contentDiv = monthContent.querySelector('.month-content');
      agendaData[month] = Array.from(contentDiv.children).map(child => {
        const checkbox = child.querySelector("input.month-check");
        let text = "";
        let done = false;
        if (checkbox) {
          text = child.querySelector("span").textContent;
          done = checkbox.checked;
        } else {
          text = child.textContent.replace("×", "").trim();
        }
        return { text, done };
      });
    }
  });

  const radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  agendaData['radarData'] = radarData;

  localStorage.setItem('agendaData', JSON.stringify(agendaData));
  alert('Agenda salva com sucesso!');
}

function loadAgenda() {
  const agendaData = JSON.parse(localStorage.getItem('agendaData') || '{}');
  days.forEach(day => {
    const dayContent = document.querySelector(`.day[data-day="${day}"] .day-content`);
    dayContent.innerHTML = '';
    if (agendaData[day]) {
      agendaData[day].forEach(topic => {
        let category = '';
        for (const ctp of allTopics) {
          if (ctp.text === topic) {
            category = ctp.category;
            break;
          }
        }
        if (!category) category = "matematica";

        const newTopic = document.createElement("div");
        newTopic.className = `topic-item ${category}`;
        newTopic.textContent = topic;

        const removeBtn = document.createElement("span");
        removeBtn.textContent = "×";
        removeBtn.title = "Remover";
        removeBtn.className = "remove-btn";
        removeBtn.onclick = () => {
          newTopic.remove();
        };

        newTopic.appendChild(removeBtn);
        dayContent.appendChild(newTopic);
      });
    }
  });

  const months = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  months.forEach(month => {
    const monthContent = Array.from(document.querySelectorAll('.month')).find(m => m.dataset.month === month);
    if (monthContent) {
      const contentDiv = monthContent.querySelector('.month-content');
      contentDiv.innerHTML = '';
      if (agendaData[month]) {
        agendaData[month].forEach(({text, done}) => {
          let category = '';
          for (const ctp of allTopics) {
            if (ctp.text === text) {
              category = ctp.category;
              break;
            }
          }
          if (!category) category = "matematica";

          const newTopic = document.createElement("div");
          newTopic.className = `topic-item ${category}`;

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "month-check";
          checkbox.title = "Marcar como concluído";
          checkbox.checked = !!done;

          const spanText = document.createElement("span");
          spanText.textContent = text;

          newTopic.appendChild(checkbox);
          newTopic.appendChild(spanText);

          if(done) newTopic.classList.add('checked');

          checkbox.addEventListener('change', () => {
            if(checkbox.checked) {
              newTopic.classList.add('checked');
            } else {
              newTopic.classList.remove('checked');
            }
          });

          const removeBtn = document.createElement("span");
          removeBtn.textContent = "×";
          removeBtn.title = "Remover";
          removeBtn.className = "remove-btn";
          removeBtn.onclick = () => {
            newTopic.remove();
          };

          newTopic.appendChild(removeBtn);
          contentDiv.appendChild(newTopic);
        });
      }
    }
  });

  if (agendaData.radarData) {
    localStorage.setItem('radarData', JSON.stringify(agendaData.radarData));
  }

  renderRadarContent();
  renderTopicsPanel();
  updateRadarMarks();
}

function renderRadarContent() {
  let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  document.querySelectorAll('#radarLevels .radar-content').forEach(div => div.innerHTML = '');

  Object.entries(radarData).forEach(([topic, level]) => {
    const container = document.querySelector(`#radarLevels .radar-level[data-level="${level}"] .radar-content`);
    if (!container) return;

    // Busca categoria para aplicar cor
    const category = allTopics.find(t => t.text === topic)?.category || "matematica";

    const div = document.createElement('div');
    div.className = `topic-item ${category}`;
    div.textContent = topic;
    div.draggable = true;
    div.addEventListener("dragstart", dragStart);

    // Botão remover para itens do radar
    const removeBtn = document.createElement("span");
    removeBtn.textContent = "×";
    removeBtn.title = "Remover";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => {
      let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
      delete radarData[topic];
      localStorage.setItem('radarData', JSON.stringify(radarData));
      renderRadarContent();
      renderTopicsPanel();
      updateRadarMarks();
    };
    div.appendChild(removeBtn);

    container.appendChild(div);
  });
}

document.getElementById('radarClearBtn').addEventListener('click', () => {
  if(confirm('Tem certeza que deseja limpar todos os dados do Radar?')) {
    localStorage.removeItem('radarData');
    renderRadarContent();
    renderTopicsPanel();
    updateRadarMarks();
  }
});

function updateRadarMarks() {
  let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  document.querySelectorAll('.month-content .topic-item').forEach(item => {
    const span = item.querySelector('span');
    if (!span) return;
    const text = span.textContent;
    item.classList.remove('radar-0','radar-1','radar-2','radar-3');
    item.title = '';
    if (radarData[text] !== undefined) {
      item.classList.add('radar-' + radarData[text]);
      const descriptions = {
        '0': 'Nunca estudei',
        '1': 'Já estudei mas não entendi muito a teoria/tenho muitas lacunas e não sei fazer os exercícios',
        '2': 'Já estudei toda a teoria mas erro muitos exercícios',
        '3': 'Domino'
      };
      item.title = descriptions[radarData[text]];
    }
  });
}

window.addEventListener('load', () => {
  renderTopicsPanel();
  loadAgenda();
  renderRadarContent();
  updateRadarMarks();
});

document.getElementById('saveBtn').addEventListener('click', saveAgenda);
document.getElementById('loadBtn').addEventListener('click', () => {
  loadAgenda();
  renderTopicsPanel();
  renderRadarContent();
  updateRadarMarks();
});
</script>
</body>
</html>
