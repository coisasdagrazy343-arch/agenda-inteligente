<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agendinha de Estudos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f0f2f5;
    user-select: none;
  }
  h1 {
    color: #5C6AC4;
    margin-bottom: 15px;
  }
  #container {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
  }
  #topics, #agenda, #monthsContainer, #radarContainer {
    background: #fff;
    border-radius: 5px;
    padding: 15px;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  #topics {
    width: 280px;
    max-height: 80vh;
    overflow-y: auto;
  }
  #topics h2 {
    margin-top: 0;
  }
  .topic-item {
    margin: 5px 0;
    padding: 6px 8px;
    border-radius: 4px;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: grab;
    position: relative;
  }
  .topic-item:active {
    cursor: grabbing;
  }
  /* Colors by category */
  .matematica { background: #4169e1; }
  .biologia { background: #2e8b57; }
  .quimica { background: #800080; }
  .fisica { background: #b22222; }
  .geografia { background: #fff1c1; color: #5a4d12; }
  .historia { background: #ffd18c; color: #5a4d12; }
  .portugues { background: #f9d5e5; color: #6a1b4d; }
  .filosofia-sociologia-literatura { background: #cde7f0; color: #1a4e7a; }
  #agenda {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    max-height: 80vh;
    overflow-y: auto;
  }
  .day, .month {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    min-height: 150px;
    padding: 10px;
    display: flex;
    flex-direction: column;
  }
  .day h3, .month h4 {
    margin: 0 0 8px 0;
    font-size: 1em;
    border-bottom: 1px solid #ccc;
    padding-bottom: 3px;
    text-align: center;
  }
  .day-content, .month-content {
    flex: 1;
    overflow-y: auto;
  }
  .day-content .topic-item, .month-content .topic-item {
    margin: 4px 0;
    border-radius: 4px;
    padding: 4px 6px;
    cursor: default;
  }
  .remove-btn {
    color: #faa;
    font-weight: bold;
    cursor: pointer;
    margin-left: 10px;
    user-select: none;
  }
  #monthsContainer {
    display: none;
    margin-top: 20px;
    flex: 1;
  }
  #monthsGrid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  /* Buttons */
  button {
    margin-right: 8px;
    padding: 7px 14px;
    border: none;
    background-color: #5C6AC4;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }
  button:hover {
    background-color: #4a54a1;
  }
  .month-content .topic-item {
    cursor: default;
    display: flex !important;
    align-items: center;
    transition: background-color 0.25s ease, opacity 0.25s ease;
  }
  .month-content .topic-item input.month-check {
    margin-right: 8px;
    cursor: pointer;
    width: 18px;
    height: 18px;
    transition: transform 0.2s ease;
  }
  .month-content .topic-item input.month-check:checked {
    animation: checkScale 0.3s ease forwards;
  }
  @keyframes checkScale {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
  }
  .month-content .topic-item.checked {
    opacity: 0.6;
    background-color: #222;
    color: #bbb;
  }
  .month-content .topic-item.checked span {
    text-decoration: line-through;
  }
  /* Radar levels text colors */
  .radar-0 { color: #721c24 !important; }
  .radar-1 { color: #856404 !important; }
  .radar-2 { color: #0c5460 !important; }
  .radar-3 { color: #155724 !important; }

  #radarContainer {
    display: none;
    margin: 0;
    padding: 15px;
    background: #fff;
    border-radius: 5px;
    flex: 1;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 0 10px rgb(0 0 0 / 0.1);
  }
  #radarLevels {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    height: 100%;
  }
  .radar-level {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    min-height: 400px;
    max-height: 650px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    color: inherit;
  }
  .radar-level strong {
    font-size: 1em;
    margin-bottom: 8px;
    user-select: none;
    color: #333;
  }
  .radar-level .topic-item {
    user-select: none;
    cursor: grab;
    margin-bottom: 4px;
    padding: 6px 10px 6px 10px;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    color: #fff;
    position: relative;
    transition: background-color 0.3s ease;
  }
  .radar-level .topic-item.matematica { background: #4169e1; color: #fff !important; }
  .radar-level .topic-item.biologia { background: #2e8b57; color: #fff !important; }
  .radar-level .topic-item.quimica { background: #800080; color: #fff !important; }
  .radar-level .topic-item.fisica { background: #b22222; color: #fff !important; }
  .radar-level .topic-item.geografia { background: #fff1c1; color: #5a4d12 !important; }
  .radar-level .topic-item.historia { background: #ffd18c; color: #5a4d12 !important; }
  .radar-level .topic-item.portugues { background: #f9d5e5; color: #6a1b4d !important; }
  .radar-level .topic-item.filosofia-sociologia-literatura { background: #cde7f0; color: #1a4e7a !important; }

  .radar-level .topic-item .remove-btn {
    color: #d44;
    font-weight: bold;
    cursor: pointer;
    position: absolute;
    top: 6px;
    right: 6px;
    user-select: none;
    font-size: 18px;
  }
  .radar-level .topic-item .edit-btn {
    position: absolute;
    top: 6px;
    right: 36px;
    font-size: 18px;
    cursor: pointer;
    user-select: none;
  }
  .radar-level .topic-item .edit-btn:hover, .radar-level .topic-item .remove-btn:hover {
    color: #ffdddd;
  }
  /* Checklist box styles */
  .checklist {
    margin-top: 28px;
    padding-left: 20px;
  }
  .checklist label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
    cursor: pointer;
  }
  .checklist input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
  }
  /* Collapsed block style */
  .collapsed .checklist {
    display: none;
  }
  .title-row {
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    user-select: none;
    padding-left: 6px;
  }

  /* Edit modal overlay */
  #editModalOverlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4);
    z-index: 10000;
    align-items: center;
    justify-content: center;
  }
  #editModal {
    background: #fff;
    padding: 20px 25px;
    border-radius: 8px;
    width: 360px;
    max-width: 94vw;
    box-shadow: 0 3px 12px rgba(0,0,0,0.3);
    font-size: 14px;
    max-height: 80vh;
    overflow-y: auto;
  }
  #editModal h3 {
    margin-top: 0;
    margin-bottom: 14px;
    font-size: 20px;
  }
  #editModal textarea {
    width: 100%;
    min-height: 150px;
    font-family: inherit;
    font-size: 14px;
    padding: 8px;
    box-sizing: border-box;
    resize: vertical;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #editModalButtons {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 12px;
  }
  #editModal button {
    padding: 8px 16px;
    font-size: 14px;
  }
</style>
</head>
<body>
<h1>Agendinha de Estudos - Arraste os conteúdos</h1>

<button id="saveBtn">Salvar Agenda</button>
<button id="loadBtn">Carregar Agenda</button>
<button id="monthBtn">Organizar por Mês</button>
<button id="radarBtn">Radar dos conteúdos</button>

<div id="container">
  <div id="topics">
    <h2>Conteúdos</h2>
  </div>

  <!-- Dias da semana -->
  <div id="agenda"></div>

  <!-- Meses -->
  <div id="monthsContainer">
    <h3>Organize seus conteúdos por mês</h3>
    <div id="monthsGrid">
      <!-- months dynamically generated below -->
    </div>
  </div>

  <!-- Radar -->
  <div id="radarContainer">
    <div id="radarLevels">
      <div class="radar-level" data-level="0" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Nunca estudei</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="1" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Lacuna Teórica</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="2" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Já estudei toda a teoria mas erro muitos exercícios</strong>
        <div class="radar-content"></div>
      </div>
      <div class="radar-level" data-level="3" ondrop="drop(event)" ondragover="allowDrop(event)">
        <strong>Domino</strong>
        <div class="radar-content"></div>
      </div>
    </div>
    <button id="radarClearBtn" style="margin-top:15px;">Limpar Radar</button>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModalOverlay">
  <div id="editModal">
    <h3>Editar checklist para conteúdo:</h3>
    <div id="modalTitleName" style="font-weight:bold; margin-bottom:8px;"></div>
    <textarea id="checklistText" placeholder="Escreva uma tarefa por linha. Exemplo:\nAssistir videoaula\nFazer 10 questões"></textarea>
    <div id="editModalButtons">
      <button id="cancelEditBtn" type="button">Cancelar</button>
      <button id="saveEditBtn" type="button">Salvar</button>
    </div>
  </div>
</div>

<script>
const days = [
  "Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado","Domingo"
];
const months = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

const mathTopics = [
  "Números e suas operações básicas",
  "Habilidades mentais básicas",
  "Frações e suas propriedades",
  "MMC, MDC e Fatoração",
  "Potenciação e radiciação",
  "Razão e Proporção",
  "Porcentagem",
  "Unidades de Medida",
  "Gráficos e Tabelas",
  "Escalas",
  "Conjuntos",
  "Estatística",
  "Função do primeiro grau",
  "Função do segundo grau",
  "Progressão aritmética",
  "Progressão geométrica",
  "Análise combinatória",
  "Probabilidade",
  "Geometria plana",
  "Geometria espacial",
  "Trigonometria",
  "Logaritmos",
  "Matemática financeira",
  "Equações",
  "Sistemas de equações"
].map(text => ({text, category:"matematica"}));

const bioTopics = [
  "Bioquímica", "Citologia", "Bioenergética", "Biologia Molecular",
  "Biotecnologia e Engenharia Genética", "Citogenética", "Ciclo Celular",
  "Origem da Vida", "Evolução", "Genética", "Ecologia", "Problemas Ambientais",
  "Ciclo Menstrual", "Sistema nervoso", "Sistema digestório",
  "Sistema cardiorrespiratório", "Sistema Imunológico", "Botânica",
  "Zoologia", "Microbiologia", "Histologia", "Sangue", "Doenças", "Drogas",
  "Taxonomia e Classificação dos Seres Vivos", "Reprodução Humana", "Embriologia"
].map(text => ({text, category:"biologia"}));

const chemistryTopics = [
  "Estudo da matéria", "Átomos", "Tabela Periódica", "Ligações Químicas",
  "Funções Inorgânicas", "Radioatividade", "Estequiometria", "Soluções",
  "Química Orgânica", "Reações Orgânicas", "Polímeros", "Isomeria",
  "Termoquímica", "Eletroquímica", "Cinética Química",
  "Equilíbrio Químico", "Propriedades Coligativas"
].map(text => ({text, category:"quimica"}));

const physicsTopics = [
  "Cinemática","Dinâmica","Ondulatória","Termologia","Estática","Quantidade de Movimento e Impulso","Trabalho e Energia",
  "Potência e Eficiência","Gravitação","Vetores","Eletrostática","Eletrodinâmica","Hidrostática","Óptica","Eletromagnetismo"
].map(text => ({text, category:"fisica"}));

const geographyTopics = [
  "Geografia Física","Meio Ambiente e Energia","Geopolítica","Geografia Econômica","População","Industrialização e Urbanização","Geografia Agrária"
].map(text => ({text, category:"geografia"}));

const historyTopics = [
  "Brasil Colônia","Brasil Império","Brasil República","Civilização pré-colombiana","Pré-história","Antiguidade",
  "Idade média","Idade moderna","Idade contemporânea"
].map(text => ({text, category:"historia"}));

const portuguesTopics = [
  "Funções da linguagem","Figuras da linguagem","Variações linguísticas","Campanhas publicitárias",
  "Gêneros e tipos textuais","Interpretação de Texto","Poemas"
].map(text => ({text, category:"portugues"}));

const filosofiaSociologiaLiteraturaTopics = [
  "Filosofia","Sociologia","Literatura"
].map(text => ({text, category:"filosofia-sociologia-literatura"}));

const allTopics = [
  ...mathTopics,...bioTopics,...chemistryTopics,...physicsTopics,
  ...geographyTopics,...historyTopics,...portuguesTopics,...filosofiaSociologiaLiteraturaTopics
];

let radarDetails = JSON.parse(localStorage.getItem('radarDetails') || '{}');
const topicsDiv = document.getElementById("topics");

// Render meses container dynamically
const monthsGrid = document.getElementById("monthsGrid");
months.forEach(m => {
  const monthDiv = document.createElement("div");
  monthDiv.className = "month";
  monthDiv.dataset.month = m;
  monthDiv.innerHTML = `<h4>${m}</h4><div class="month-content" ondrop="drop(event)" ondragover="allowDrop(event)"></div>`;
  monthsGrid.appendChild(monthDiv);
});

function renderTopicsPanel() {
  const radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  const radarTopics = new Set(Object.keys(radarData));
  topicsDiv.querySelectorAll('.topic-item').forEach(item => item.remove());
  allTopics.forEach(({text, category}) => {
    if (!radarTopics.has(text)) {
      const div = document.createElement("div");
      div.classList.add("topic-item", category);
      div.textContent = text;
      div.draggable = true;
      div.addEventListener("dragstart", dragStart);
      topicsDiv.appendChild(div);
    }
  });
}

const agendaDiv = document.getElementById("agenda");
days.forEach(day => {
  const dayDiv = document.createElement("div");
  dayDiv.className = "day";
  dayDiv.dataset.day = day;
  dayDiv.innerHTML = `<h3>${day}</h3><div class="day-content" ondrop="drop(event)" ondragover="allowDrop(event)"></div>`;
  agendaDiv.appendChild(dayDiv);
});

function dragStart(event) {
  const el = event.target;
  event.dataTransfer.setData("text/plain", el.textContent);
  event.dataTransfer.effectAllowed = "copyMove";
  event.dataTransfer.setData("source-type", getContainerType(el.parentElement));
  event.dataTransfer.setData("source-html", el.outerHTML);
}

function getContainerType(container) {
  if (!container) return '';
  if (container.id === "topics") return "topics";
  if (container.classList.contains("radar-content")) return "radar";
  if (container.classList.contains("day-content")) return "day";
  if (container.classList.contains("month-content")) return "month";
  return '';
}

function allowDrop(event) {
  event.preventDefault();
  event.dataTransfer.dropEffect = "copy";
}

function drop(event) {
  event.preventDefault();
  const topic = event.dataTransfer.getData("text/plain");
  if (!topic) return;
  let container = event.currentTarget;
  if (!container.classList.contains("day-content") &&
      !container.classList.contains("month-content") &&
      !container.classList.contains("radar-content") &&
      container.id !== 'topics') {
    container = container.querySelector(".day-content") || container.querySelector(".month-content") || container.querySelector(".radar-content") || container;
  }
  if (Array.from(container.children).some(child => child.textContent.replace("×", "").replace("✏️", "").trim() === topic)) return;
  let category = "";
  for (const ctp of allTopics) if (ctp.text === topic) { category = ctp.category; break; }
  if (!category) category = "matematica";
  const sourceType = event.dataTransfer.getData("source-type");

  if(container.id === "topics") return;
  if(container.classList.contains("month-content")) {
    const newTopic = document.createElement("div");
    newTopic.className = `topic-item ${category}`;
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.className = "month-check";
    checkbox.title = "Marcar como concluído";
    const spanText = document.createElement("span");
    spanText.textContent = topic;
    newTopic.appendChild(checkbox);
    newTopic.appendChild(spanText);
    checkbox.addEventListener('change', () => {
      if(checkbox.checked) newTopic.classList.add('checked');
      else newTopic.classList.remove('checked');
    });
    const removeBtn = document.createElement("span");
    removeBtn.textContent = "×";
    removeBtn.title = "Remover";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => newTopic.remove();
    newTopic.appendChild(removeBtn);
    container.appendChild(newTopic);
  } else if(container.classList.contains("radar-content")) {
    const radarLevelDiv = container.closest(".radar-level");
    if(!radarLevelDiv) return;
    const level = radarLevelDiv.dataset.level;
    let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
    radarData[topic] = parseInt(level);
    localStorage.setItem('radarData', JSON.stringify(radarData));
    if (!radarDetails[topic]) {
      radarDetails[topic] = [];
      localStorage.setItem('radarDetails', JSON.stringify(radarDetails));
    }
    renderRadarContent();
    renderTopicsPanel();
  } else if(container.classList.contains("day-content")) {
    const newTopic = document.createElement("div");
    newTopic.className = `topic-item ${category}`;
    newTopic.textContent = topic;
    const removeBtn = document.createElement("span");
    removeBtn.textContent = "×";
    removeBtn.title = "Remover";
    removeBtn.className = "remove-btn";
    removeBtn.onclick = () => newTopic.remove();
    newTopic.appendChild(removeBtn);
    container.appendChild(newTopic);
  }
  if (sourceType === "radar") {
    let radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
    if (radarData.hasOwnProperty(topic)) {
      delete radarData[topic];
      localStorage.setItem('radarData', JSON.stringify(radarData));
      renderRadarContent();
      renderTopicsPanel();
    }
  } else if (sourceType === "topics") {
    renderTopicsPanel();
  }
}

const editModalOverlay = document.getElementById('editModalOverlay');
const checklistText = document.getElementById('checklistText');
const modalTitleName = document.getElementById('modalTitleName');
const saveEditBtn = document.getElementById('saveEditBtn');
const cancelEditBtn = document.getElementById('cancelEditBtn');
let currentEditTopic = null;

function openEditModal(topic) {
  currentEditTopic = topic;
  modalTitleName.textContent = topic;
  // load checklist lines joined by \n
  const items = radarDetails[topic] || [];
  checklistText.value = items.join('\n');
  editModalOverlay.style.display = 'flex';
  checklistText.focus();
}
function closeEditModal() {
  editModalOverlay.style.display = 'none';
  currentEditTopic = null;
}

saveEditBtn.onclick = () => {
  if(currentEditTopic === null) return;
  // Save lines as array, trimming empty lines
  const lines = checklistText.value.split('\n').map(l=>l.trim()).filter(l=>l.length>0);
  radarDetails[currentEditTopic] = lines;
  localStorage.setItem('radarDetails', JSON.stringify(radarDetails));
  closeEditModal();
  renderRadarContent();
};
cancelEditBtn.onclick = () => {
  closeEditModal();
};
editModalOverlay.onclick = e => {
  if(e.target === editModalOverlay) closeEditModal();
};

function renderRadarContent() {
  radarDetails = JSON.parse(localStorage.getItem('radarDetails') || '{}');
  const radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  document.querySelectorAll('#radarLevels .radar-content').forEach(div=> div.innerHTML = '');

  Object.entries(radarData).forEach(([topic, level]) => {
    const container = document.querySelector(`#radarLevels .radar-level[data-level="${level}"] .radar-content`);
    if(!container) return;
    const category = allTopics.find(t => t.text === topic)?.category || "matematica";

    const block = document.createElement('div');
    block.className = `topic-item ${category}`;
    block.draggable = true;

    const titleRow = document.createElement('div');
    titleRow.className = 'title-row';
    titleRow.textContent = topic;
    block.appendChild(titleRow);

    // Edit and remove buttons
    const editBtn = document.createElement('span');
    editBtn.className = 'edit-btn';
    editBtn.innerHTML = '✏️';
    editBtn.title = 'Editar checklist';
    editBtn.onclick = (e) => {
      e.stopPropagation();
      openEditModal(topic);
    };
    block.appendChild(editBtn);

    const removeBtn = document.createElement('span');
    removeBtn.className = 'remove-btn';
    removeBtn.textContent = '×';
    removeBtn.title = 'Remover do Radar';
    removeBtn.onclick = e => {
      e.stopPropagation();
      let radarDataObj = JSON.parse(localStorage.getItem('radarData') || '{}');
      delete radarDataObj[topic];
      localStorage.setItem('radarData', JSON.stringify(radarDataObj));
      if(radarDetails[topic]){
        delete radarDetails[topic];
        localStorage.setItem('radarDetails', JSON.stringify(radarDetails));
      }
      renderRadarContent();
      renderTopicsPanel();
    };
    block.appendChild(removeBtn);

    // Checklist area:
    const checklist = document.createElement('div');
    checklist.className = 'checklist';
    const items = radarDetails[topic] || [];

    if(items.length === 0){
      const emptyMsg = document.createElement('em');
      emptyMsg.style.fontSize = '13px';
      emptyMsg.style.opacity = '0.8';
      emptyMsg.textContent = '(sem tarefas)';
      checklist.appendChild(emptyMsg);
    } else {
      items.forEach((item,i) => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = "checkbox";
        checkbox.id = topic + '_chk_' + i;
        const span = document.createElement('span');
        span.textContent = item;
        label.appendChild(checkbox);
        label.appendChild(span);
        checklist.appendChild(label);
      });
    }
    block.appendChild(checklist);

    // Collapsible logic
    let collapsed = false;
    titleRow.style.userSelect = 'none';
    titleRow.style.cursor = 'pointer';

    titleRow.onclick = () => {
      collapsed = !collapsed;
      if(collapsed){
        block.classList.add('collapsed');
      } else {
        block.classList.remove('collapsed');
      }
    };

    block.addEventListener('dragstart', dragStart);
    container.appendChild(block);
  });
}

document.getElementById('radarClearBtn').onclick = () => {
  if(confirm('Tem certeza que deseja limpar todos os dados do Radar?')){
    localStorage.removeItem('radarData');
    localStorage.removeItem('radarDetails');
    radarDetails = {};
    renderRadarContent();
    renderTopicsPanel();
  }
};

// Save/load agenda functions
function saveAgenda() {
  const agendaData = {};
  // Days
  days.forEach(day => {
    const dayContent = document.querySelector(`.day[data-day="${day}"] .day-content`);
    agendaData[day] = Array.from(dayContent.children).map(c => c.textContent.replace("×", "").trim());
  });
  // Months
  months.forEach(month => {
    const monthDiv = Array.from(document.querySelectorAll('.month')).find(m => m.dataset.month === month);
    if(monthDiv){
      const contentDiv = monthDiv.querySelector('.month-content');
      agendaData[month] = Array.from(contentDiv.children).map(child => {
        const checkbox = child.querySelector("input.month-check");
        let text = "";
        let done = false;
        if(checkbox){
          text = child.querySelector("span").textContent;
          done = checkbox.checked;
        } else {
          text = child.textContent.replace("×", "").trim();
        }
        return {text, done};
      });
    }
  });
  // Radar data and details
  const radarData = JSON.parse(localStorage.getItem('radarData') || '{}');
  agendaData['radarData'] = radarData;
  agendaData['radarDetails'] = radarDetails;

  localStorage.setItem('agendaData', JSON.stringify(agendaData));
  alert('Agenda salva com sucesso!');
}

function loadAgenda() {
  const agendaData = JSON.parse(localStorage.getItem('agendaData') || '{}');
  // Days
  days.forEach(day => {
    const dayContent = document.querySelector(`.day[data-day="${day}"] .day-content`);
    dayContent.innerHTML = '';
    if(agendaData[day]){
      agendaData[day].forEach(topic => {
        let category = allTopics.find(t => t.text === topic)?.category || 'matematica';
        const div = document.createElement("div");
        div.className = `topic-item ${category}`;
        div.textContent = topic;
        const removeBtn = document.createElement("span");
        removeBtn.textContent = "×";
        removeBtn.title = "Remover";
        removeBtn.className = "remove-btn";
        removeBtn.onclick = () => div.remove();
        div.appendChild(removeBtn);
        dayContent.appendChild(div);
      });
    }
  });
  // Months
  months.forEach(month => {
    const monthDiv = Array.from(document.querySelectorAll('.month')).find(m => m.dataset.month === month);
    if(monthDiv){
      const contentDiv = monthDiv.querySelector('.month-content');
      contentDiv.innerHTML = '';
      if(agendaData[month]){
        agendaData[month].forEach(({text, done}) => {
          let category = allTopics.find(t => t.text===text)?.category || 'matematica';
          const div = document.createElement("div");
          div.className = `topic-item ${category}`;
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "month-check";
          checkbox.title = "Marcar como concluído";
          checkbox.checked = !!done;
          const spanText = document.createElement("span");
          spanText.textContent = text;
          div.appendChild(checkbox);
          div.appendChild(spanText);
          if(done) div.classList.add('checked');
          checkbox.onchange = () => {
            if(checkbox.checked) div.classList.add('checked');
            else div.classList.remove('checked');
          };
          const removeBtn = document.createElement("span");
          removeBtn.textContent = "×";
          removeBtn.title = "Remover";
          removeBtn.className = "remove-btn";
          removeBtn.onclick = () => div.remove();
          div.appendChild(removeBtn);
          contentDiv.appendChild(div);
        });
      }
    }
  });
  // Radar data and details
  if(agendaData.radarData){
    localStorage.setItem('radarData', JSON.stringify(agendaData.radarData));
  }
  if(agendaData.radarDetails){
    localStorage.setItem('radarDetails', JSON.stringify(agendaData.radarDetails));
    radarDetails = agendaData.radarDetails;
  } else {
    radarDetails = {};
  }
  renderRadarContent();
  renderTopicsPanel();
}

document.getElementById('saveBtn').addEventListener('click', saveAgenda);
document.getElementById('loadBtn').addEventListener('click', () => {
  loadAgenda();
});

// View control buttons
document.getElementById('monthBtn').addEventListener('click', () => {
  document.getElementById('monthsContainer').style.display = 'block';
  document.getElementById('radarContainer').style.display = 'none';
  document.getElementById('agenda').style.display = 'none';
  document.getElementById('topics').style.display = 'block';
});
document.getElementById('radarBtn').addEventListener('click', () => {
  document.getElementById('radarContainer').style.display = 'flex';
  document.getElementById('monthsContainer').style.display = 'none';
  document.getElementById('agenda').style.display = 'none';
  document.getElementById('topics').style.display = 'block';
});

window.addEventListener('load', () => {
  document.getElementById('agenda').style.display = 'grid';
  document.getElementById('monthsContainer').style.display = 'none';
  document.getElementById('radarContainer').style.display = 'none';
  document.getElementById('topics').style.display = 'block';

  renderTopicsPanel();
  loadAgenda();
  renderRadarContent();
});

</script>
</body>
</html>

